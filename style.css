/*
   1) MOVING BACKGROUND PARTICLES (Paste this at top!)
 */

(function () {
  const canvas = document.getElementById('bg-canvas');
  if (!canvas) return;

  const ctx = canvas.getContext('2d', { alpha: true });

  const config = {
    particleCount: Math.round(Math.max(window.innerWidth, 800) / 18),
    baseSize: 2.2,
    sizeVariation: 2.3,
    speed: 0.2,
    drift: 0.3,
    lineDistance: 120,
    color1: [255, 255, 255, 0.18],
    color2: [138, 180, 255, 0.08],
    useGradient: true
  };

  let W = 0, H = 0;
  let particles = [];
  let animationId = null;

  function resize() {
    W = canvas.width = Math.ceil(window.innerWidth);
    H = canvas.height = Math.ceil(window.innerHeight);
    initParticles();
  }

  function rand(min, max) { return Math.random() * (max - min) + min; }

  function mixColor(c1, c2, t) {
    return [
      c1[0] + (c2[0] - c1[0]) * t,
      c1[1] + (c2[1] - c1[1]) * t,
      c1[2] + (c2[2] - c1[2]) * t,
      c1[3] + (c2[3] - c1[3]) * t,
    ];
  }

  function rgba(arr) {
    return `rgba(${Math.round(arr[0])}, ${Math.round(arr[1])}, ${Math.round(arr[2])}, ${arr[3]})`;
  }

  function createParticle() {
    const t = Math.random();
    const size = Math.abs(rand(config.baseSize - config.sizeVariation, config.baseSize + config.sizeVariation));
    const speedY = rand(0.2, 0.9) * config.speed;
    const speedX = rand(-config.drift, config.drift);
    const col = mixColor(config.color1, config.color2, t);

    return {
      x: rand(0, W),
      y: rand(0, H),
      vx: speedX,
      vy: -speedY,
      r: size,
      color: rgba(col),
      floatPhase: rand(0, Math.PI * 2),
      floatAmp: rand(6, 22)
    };
  }

  function initParticles() {
    particles = [];
    const count = Math.max(30, Math.min(180, config.particleCount));
    for (let i = 0; i < count; i++) particles.push(createParticle());
  }

  function drawParticle(p) {
    p.floatPhase += 0.002 + (p.r * 0.0005);
    const bob = Math.sin(p.floatPhase) * p.floatAmp;

    const cx = p.x + bob * 0.2;
    const cy = p.y;

    const g = ctx.createRadialGradient(cx, cy, 0, cx, cy, p.r * 6);
    g.addColorStop(0, "rgba(255,255,255,0.9)");
    g.addColorStop(0.3, "rgba(255,255,255,0.4)");
    g.addColorStop(1, p.color);

    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc(cx, cy, p.r, 0, Math.PI * 2);
    ctx.fill();
  }

  function step(t) {
    ctx.clearRect(0, 0, W, H);

    for (let p of particles) {
      p.x += p.vx;
      p.y += p.vy;

      if (p.y < -50) p.y = H + 50;
      if (p.x < -50) p.x = W + 50;
      if (p.x > W + 50) p.x = -50;

      drawParticle(p);
    }

    animationId = requestAnimationFrame(step);
  }

  resize();
  animationId = requestAnimationFrame(step);

  window.addEventListener("resize", () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(resize, 150);
  });

})();


/* ----------------------------------------------------------
   DARK / LIGHT MODE
---------------------------------------------------------- */

const modeBtn = document.getElementById("modeToggle");

modeBtn.addEventListener("click", () => {
    document.body.classList.toggle("dark-mode");

    if (document.body.classList.contains("dark-mode")) {
        modeBtn.textContent = "Switch to Light Mode â˜€ï¸";
    } else {
        modeBtn.textContent = "Switch to Dark Mode ðŸŒ™";
    }
});


/* ----------------------------------------------------------
   CONTACT FORM VALIDATION
---------------------------------------------------------- */

const contactForm = document.getElementById("contactForm");

if (contactForm) {
    contactForm.addEventListener("submit", function (e) {
        e.preventDefault();

        let name = document.getElementById("name").value.trim();
        let email = document.getElementById("email").value.trim();
        let message = document.getElementById("message").value.trim();

        if (!name || !email || !message) {
            alert("â— Please fill out all fields.");
        } else {
            alert("âœ… Message submitted successfully!");
            this.reset();
        }
    });
}


/* ----------------------------------------------------------
   COUNTER FEATURE
---------------------------------------------------------- */

let count = 0;

function increaseCounter() {
    count++;
    document.getElementById("counterValue").textContent = count;
}


/* ----------------------------------------------------------
   TASK MANAGER
---------------------------------------------------------- */

const addTaskBtn = document.getElementById("addTaskBtn");
const taskList = document.getElementById("taskList");
const taskInput = document.getElementById("taskInput");

if (addTaskBtn) {
    addTaskBtn.addEventListener("click", () => {
        const text = taskInput.value.trim();

        if (text === "") {
            alert("âš  Enter a task first.");
            return;
        }

        const li = document.createElement("li");
        li.innerHTML = `
            ${text}
            <button class="completeBtn">âœ”</button>
            <button class="deleteBtn">ðŸ—‘</button>
        `;

        taskList.appendChild(li);
        taskInput.value = "";

        li.querySelector(".completeBtn").addEventListener("click", () => {
            li.classList.toggle("completed");
        });

        li.querySelector(".deleteBtn").addEventListener("click", () => {
            li.remove();
        });
    });
}


/* ----------------------------------------------------------
   MOBILE NAV MENU TOGGLE
---------------------------------------------------------- */

const mobileMenuBtn = document.getElementById("mobileMenuBtn");
const nav = document.querySelector("nav");

if (mobileMenuBtn) {
    mobileMenuBtn.addEventListener("click", () => {
        nav.classList.toggle("showMenu");
    });
}

/* ----------------------------------------------------------
   SMOOTH SCROLL FOR NAV LINKS
---------------------------------------------------------- */

document.querySelectorAll("nav a").forEach(link => {
    link.addEventListener("click", function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute("href"));

        if (target) {
            window.scrollTo({
                top: target.offsetTop - 50,
                behavior: "smooth"
            });
        }

        nav.classList.remove("showMenu"); // Close mobile menu
    });
});


/* ----------------------------------------------------------
   SCROLL REVEAL ANIMATION
---------------------------------------------------------- */

const revealElements = document.querySelectorAll("section, article, .skills-grid div");

function revealOnScroll() {
    const triggerBottom = window.innerHeight * 0.85;

    revealElements.forEach(el => {
        const top = el.getBoundingClientRect().top;

        if (top < triggerBottom) {
            el.classList.add("visible");
        }
    });
}

window.addEventListener("scroll", revealOnScroll);
revealOnScroll();


/* ----------------------------------------------------------
   BUTTON RIPPLE EFFECT
---------------------------------------------------------- */

document.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", function (e) {

        const ripple = document.createElement("span");
        ripple.classList.add("ripple");

        const rect = btn.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        ripple.style.left = `${x}px`;
        ripple.style.top = `${y}px`;

        btn.appendChild(ripple);

        setTimeout(() => ripple.remove(), 600);
    });
});


/* ----------------------------------------------------------
   HEADER FLOATING GLOW ANIMATION
---------------------------------------------------------- */

const header = document.querySelector("header");

function floatingGlow() {
    header.classList.add("glow-effect");

    setTimeout(() => {
        header.classList.remove("glow-effect");
    }, 3000);
}

setInterval(floatingGlow, 8000);
